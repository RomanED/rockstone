# Задача 1
Дано: фрагмент исходного кода сервера (файл Client.cpp).
Задание:
Найти и кратко описать (в 2–3 предложениях) три участка кода, которые можно улучшить с точки зрения читаемости, архитектуры или производительности.


Предложить и реализовать улучшения в одном из этих участков кода – в виде патча или отдельного нового файла с исправлениями.

## Код ревью:
1. Уязвимость времени жизни данных (Client.cpp:login)
    Локальный объект LoginData data передаётся в асинхронный запрос, но уничтожается при выходе из метода. Когда колбэк попытается получить доступ к &data, это приведёт к неопределённому поведению (висячая ссылка). Особенно критично при сетевых задержках.

2. Отсутствие валидации входящих пакетов
    Методы обработки пакетов (params_set, buy, login) не проверяют:
   
        - Корректность индексов полей
        - Типы данных полей
        - Наличие обязательных полей
        - Бизнес-ограничения (например, отрицательные item_id)

4. Небезопасная работа с состоянием игрока
    Указатель player инициализируется только при успешном логине, но другие методы (params_set, buy) используют его без проверки. При получении пакетов до авторизации это вызовет segmentation fault.

## Ключевые улучшения:

    Система состояний клиента
        - Понятные состояния клиента: CONNECTED → AUTHENTICATING → LOGGED_IN
        - Блокировка повторных логинов
        - Защита от пакетов до авторизации
        
    Безопасная асинхронная аутентификация
        - std::shared_ptr гарантирует время жизни данных (можно использовать unique_ptr, но я передаю владение в лямбду поэтому решено использовать shared)
        - mutable в лямбде позволяет перемещать владение
        - Проверка состояния при колбэке на случай дисконнекта

    Комплексная валидация
        - Проверка структуры пакета (количество полей)
        - Валидация корректности данных (корректность ID, типов)
        - Защита от некорректных значений (item_id = 0)

    Устойчивость к исключениям
        - Централизованная обработка ошибок
        - Безопасное восстановление состояния
        - Предсказуемое поведение при повреждённых пакетах
